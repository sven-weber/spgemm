#!/bin/bash
#SBATCH --time=03:00:00
#SBATCH --constraint=mc
#SBATCH --output={{ log_out }}
#SBATCH --switches={{ switches }}
#SBATCH --mem=0
#SBATCH -N {{ n_machines }}
#SBATCH -n {{ mpi_processes }}
#SBATCH --cpus-per-task={{ processes_per_mpi }}
#SBATCH -A g34
{% if last_job %}
#SBATCH --dependency=afterany:{{ last_job }}
{% endif %}

export OMP_NUM_THREADS={{ processes_per_mpi }}
{% for impl in impls %}
    {% for matrix in matrices %}
mkdir {{ runs_dir }}/{{ n_machines }}_{{ mpi_processes }}_{{ impl }}_{{ matrix }}
srun {{ cmd }} {{ impl }} {{ matrix }} {{ runs_dir }}/{{ impl }}_{{ matrix }} {{ n_runs }} {{ n_warmup }} {{ shuffling }} {{ partitioning }} {{ parallel_load_str }} {{ persist_str }} {{ matrix_path }}
    {% endfor %}
{% endfor %}
